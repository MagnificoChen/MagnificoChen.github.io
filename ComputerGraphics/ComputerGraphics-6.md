<head>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [["$$", "$$"], ["\\[", "\\]"]],
  },
  svg: {
    fontCache: 'global'
  }
};
</script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js">
</script>

</head>

# 第十五章 曲线 _By Micheal Gleicher_

## 15.1 曲线

直观上，我们可以把曲线想象成用笔画出来的东西。曲线是笔在一段时间内画出的一组点。尽管我们想到的应该是一支笔在纸上写字（如二维空间中的曲线），但实际上，笔可以在三维空间中移动，画出空间的曲线。

在数学上，曲线的定义至少可以通过两种方式来理解：

1. n 维空间中在某区间内产生的连续图像
2. 从一维空间到 n 维空间的连续映射

这两种定义都是从区间（笔沿着曲线开始画的时间区间）这一概念开始的。然而，有一个显著的区别：在第一个定义中，曲线是笔根据时间画出的点的集合（图像），而在第二个定义中，曲线是时间和这组点之间的映射。在本章中，我们用第一个定义。

曲线是无限多个点的集合。曲线上的点具有这样的特性，即任何点都有两个邻居，除了少数点只有一个邻居(端点)。有些曲线没有端点，要么是因为它们是无限的(直线)，要么是因为它们是封闭的(自环)。

因为曲线的“笔”很细(无限小)，所以很难创建填充区域。虽然我们有可能做到在空间填充曲线(通过将它们无限次折叠起来)，但我们在这里不考虑这种数学上的奇怪现象。一般来说，我们认为曲线是物体的 _轮廓_ 。

我们需要解决的问题是如何指定曲线 —— 命名，以及给出曲线的一种表示，以便我们可以在计算机上绘制。对于某些曲线，命名问题很容易，因为它们的形状家喻户晓：线段、圆、圆弧等。没有“命名”形状的一般曲线有时被称为 _自由曲线_ 。因为自由曲线几乎可以呈现任何形状，所以它们很难指定和特化。

有三种主要的数学方法来定义一条曲线：

1. **隐式曲线** 曲线表示通过给出一个过程来定义曲线上的点的集合，这个过程可以测试一个点是否在曲线上。通常，隐式曲线表示法由如下形式的隐函数定义：

   $$f(x,y) = 0$$

曲线就是满足这个方程的点的集合。隐函数 $f$ 是一个标量函数(它返回一个实数)。

1. **参数曲线** 参数曲线表示提供了从 _自由参数_ 到曲线上点集的映射。也就是说，这个所谓的自由参数提供了曲线上点的索引。曲线的参数形式是为自由参数值分配位置的函数。直观地讲，如果你把曲线想象成可以用笔在纸上画的轨迹，自由参数就是时间 —— 从我们 **开始画** 到 **完成曲线** 的时间。曲线的参数函数告诉我们笔在任意时刻的位置：
   $$(x,y) = {\rm\textbf{f}(t)},$$
   参数函数是一个向量函数。这个例子是一个二维曲线，所以函数的输出是一个二维向量，在三维中则是一个三维向量。

2. **生成式曲线** 生成式曲线（以及过程曲线）的表示法可以提供不属于前两类曲线上的点的过程曲线。生成曲线描述的例子包括 **细分** 和 **分形** 。

记住，曲线是点的集合。这些表示法也只是一些能让我们能获取那些点集的方法。曲线有许多不同的表示法，一条曲线可以被表示成多种形式。因此，数学家通常会小心地区分曲线和它的表示法。不过，在计算机图形学中，我们对这方面的约束比较宽松，因为我们通常只需要知道表示法，而不是曲线本身。当我们讲到“隐式曲线”时，指的要么是用隐函数表示的 **曲线** ，要么是曲线的一种表示形式： **隐函数** 。除非我们需要考虑同一曲线的不同表示，不然前面两个其实讲的是同一个东西。由于我们将在本章中讨论不同的曲线表示，这方面的描述会比较重要。当我们使用“多项式曲线”这样的术语时，我们要指的是：可以用多项式表示的 **曲线** 。

根据本章开头给出的定义，曲线必须有参数表示。然而，许多曲线有其他的表示。例如，一个圆心为原点，半径为 1 的二维圆可以隐式表示为：

$$f(x,y) = x^2+y^2-1=0$$

或者用参数化表示：

$$(x,y) = \mathbf{f}(t) = (\cos t, \sin t)$$

对于给定曲线，参数形式不一定是最方便的表示。事实上，曲线可能具有简单的隐式或生成式表示，但 **很难** 找到参数表示。

不同的曲线表示方式各有优缺点。例如，参数曲线更容易绘制，因为我们可以对自由参数进行采样，得到曲线上的点。一般来说，参数形式是计算机图形学中最常用的，因为它们更容易使用。我们的重点也会放在曲线的参数化表示。

### 15.1.1 参数化 与 重新参数化

> 参数化的好处是给了我们一种方便对比不同曲线的方法, 但是缺点是对曲线进行的参数化有时候会导致混乱, 这是因为曲线本身是不需要这个特殊参数的参与的(例如隐式曲线). 只看参数形式的话很多截然不同的曲线会有相同的参数形式, 这些曲线绘制出来的时形象是一样的, 但是例如在曲线内将参数写为二次幂形式, 同样参数为 0.5 时, 二次幂的代表的点显然与一次时代表的不同。

> 相同的曲线出现了不同的表达, 解决方法是给出共识让各个机器都以相同的方法选择参数, 这种为了便于定义曲线创建的参数形式称为自然参数化, 最常用的是弧长参数化, 也就是让函数沿着曲线的弧长改变, 相当于固定了函数的切线斜率。

_参数曲线_ 是指在特定 **区间** 内由特定参数函数给出的曲线。更精确地说，参数曲线有一个给定的函数，它是参数区间的 **映射** 。我们发现，让参数在从 $0$ 到 $1$ 的单位间隔内进行映射会很方便。当自由参数在单位区间内变化时，我们通常用 $u$ 来表示参数。

如果我们把参数化曲线看作是用笔画的一条线，我们可以认为 $u = 0$ 是笔第一次放在纸上的时间，参数的单位是绘制曲线所需的时间 ( $u = 1$ 是曲线的终点)。

曲线可以通过将时间（区间内的参数）映射到位置的函数来指定。基本上，如果一个函数可以回答“ $u$ 时刻笔在哪里？”的问题，那它就能确定一条曲线。

如果给定一个函数 $\mathbf{f}(t)$ ，它表示区间 $[a, b]$ 上的曲线，我们可以很容易地找到一个新函数 $\mathbf{f}_2(u)$ ，它表示单位区间 $[0,1]$ 上的相同曲线。我们可以首先定义：

$$g(u) = a+(b-a)u$$

然后

$$\mathbf{f}_2(u) = \mathbf{f}(g(u))$$

这两个函数 $\mathbf{f}$ 和 $\mathbf{f}_2$ 都表示同一条曲线。然而，它们提供了不同的曲线参数化。我们将参数区间进行转换，为的是之后处理更方便。为现有曲线创建新参数化的过程称为 _重新参数化_ ，从旧参数到新参数（在本例中为 $g$ ）的映射称为 _重新参数化函数_ 。

如果我们通过一些参数化定义了一条曲线，那么存在无限多的其他参数化（因为我们总是可以重新参数化）。能够对曲线进行多个参数化很有用，因为它允许我们创建方便的参数化。然而，它也可能有问题，因为重新参数化后，你很难看出来两个不同的函数是否表示同一条曲线。

这个问题的本质更普遍：自由参数（或时间元素）的存在为我们的曲线表示增加了一个看不见的，潜在的未知元素。也就是说，当我们看到画好的曲线时，我们不一定知道时间是什么。这支笔可能在整个时间间隔内以恒定的速度移动，或者它可能开始很慢，然后加速。

例如，虽然 $u = 0.5$ 是参数空间的中间点，但如果笔的运动开始很慢，并在后面加速，则它对应的点就可能不是曲线的中点。考虑下面一条非常简单的曲线的表示：

$$(x,y) = \mathbf{f}(u) = (u,u)$$
$$(x,y) = \mathbf{f}(u) = (u^2,u^2)$$
$$(x,y) = \mathbf{f}(u) = (u^5,u^5)$$

这三个函数在单位区间上显然表示同一曲线。然而，当 $u$ 不为 $0$ 或 $1$ 时， $\mathbf{f}(u)$ 在这三个函数中指的是不同的点。

如果我们给出了曲线的参数化，我们可以直接使用它来说明曲线，抑或是，我们可以开发一个更方便的参数化形式。

通常，我们用 _自然参数化_ 来创造一种方便确定曲线的参数化表示。这样我们就不需要知道参数沿曲线的变化速度。

如果我们提前能知道笔是 **匀速移动** 的，那么自由参数的值会变得更有意义，因为参数在区间中点的时候就是曲线的中点。因此，我们不用时间作为参数，而是用 _曲线长度_ 作为参数。这种参数化称为 _弧长参数化_ ，因为它们通过从沿曲线的距离(称为弧长)映射到位置的函数来定义曲线。我们经常用变量 $s$ 来表示弧长参数。

> 也就是说，速度恒定的参数曲线即是弧长参数化曲线。

理论上来说，如果一个曲线弧长 _正切，tangent_ 的大小（即参数化对参数的导数）是 **常数** ，则这样的参数化就是 **弧长参数化** 。用方程表示，

$$\left| \frac{d\mathbf{f}(s)}{ds}\right|^2 = c$$

计算一条曲线的长度是很棘手的。一般来说，它是由上述导数的积分来定义的（直观地说，导数的大小是笔沿着曲线移动的速度）。因此，给定参数 $v$ 的值，你可以计算 $s$ （沿曲线从点 $\mathbf{f}(0)$ 到点 $\mathbf{f}(v)$ 的弧长距离）是：

$$s = \int^{v}_{0} \left| \frac{d\mathbf{f}(t)}{dt}\right|^2 dt \tag{15.1}$$

由于上式可写为函数： $s = s(v)$ ，函数是单调递增的。所以有反函数： $v = v(s)$ 。此时我们可以找到 $\mathbf{f}(v(s))$ 这个函数，它可以在给定弧长 $s$ 的情况下，先得到点的参数，再由参数获得该点的值。

至此我们称， $\mathbf{f}(t)$ 是用 **自然参数化** 定义曲线的函数。

使用弧长参数化要求能够在给定 $s$ 的情况下解出 $t$ (方程 15.1)。但是，对于我们所研究的许多类型的曲线，我们找不到它的 _闭式解_ （解析解），只能找到它的数值解。

通常，我们使用变量 $u$ 来表示在单位区间内的自由参数， $s$ 来表示弧长自由参数， $t$ 来表示除前两个之外定义的自由参数。

### 15.1.2 分段参数化曲线的表示

对于一些曲线，我们很容易就能找到一个参数函数来表示它们的形状。例如，直线、圆和椭圆都有简单的函数，可以根据参数定义它们所包含的点。但是，对于许多曲线来说，找到一个函数来指定它们的形状是很困难的。那么怎么办呢？我们创建复杂曲线的主要策略是分而治之：将曲线分解成许多更简单的小段，每段都有一个简单的描述。

例如，考虑 [图 15-1] 中的曲线。前面的这两条线很容易分成两部分，在图中(b)所示曲线的情况下，我们通过线段和圆来分段描述。

要创建复合曲线的参数表示（如 [图 15-1] (b)中的曲线），我们需要让参数函数在表示分段之间的能够切换。如果我们在 $0≤u≤1$ 的范围内定义了参数函数，那么 [图 15-1] (a)或(b)中的曲线可以定义为

$$
\mathbf{f}(u)=\left\{
\begin{aligned}
\mathbf{f}_1(2u) \ \ \ \ \ \ \ \ & {\rm if} & u\leq 0.5 \\
\mathbf{f}_2(2u-1) \ \ \ \ \ \ \ \  & {\rm if} & u > 0.5 \\
\end{aligned}
\right. \tag{15.2}
$$

其中 $\mathbf{f}_1$ 是第一段的参数化， $\mathbf{f}_2$ 是第二段的参数化，并且两个函数的定义域都是单位区间。

我们需要仔细定义函数 $\mathbf{f}_1$ 和 $\mathbf{f}_2$ ，以确保曲线的各个部分能匹配在一起。如果 $\mathbf{f}_1(1)  \neq \mathbf{f}_2(0)$ ，我们定义出来的曲线段会不连续。

为了表示 [图 15-1] (b)中的曲线，我们需要使用两种不同类型的曲线种类：线段和圆弧。我们可能更喜欢使用单一类型的曲线段，因为那样比较简单。但如果我们试图只用一种类型的曲线段来表示 [图 15-1] (b)中的曲线（如 [图 15-1] (c)所示），两条曲线看上去就不一样了。如果对于使用来说，它已经足够精确，那你也可以尝试这样的方法来近似曲线。

当我们使用越来越多的线段时，我们画出来的线就越近似原来的曲线。在极限情况下（使用无限数量的线段），我们可以准确地表示原始形状。

使用分段表示的一个优点是，它让我们能够在以下几个方面做权衡：

1. 我们所表示的曲线需要与实际形状有多近似
2. 我们用的曲线段要多复杂
3. 我们要用多少段曲线段

因此，如果我们要表示的形状很复杂，那么我们或许可以粗略地近似一下。如果要近似的效果很好，那么可以选择使用更多的片段，以及使用更复杂的片段。

在计算机图形学实践中，我们倾向于使用相对简单的曲线片段（线段、弧或多项式线段）。

### 15.1.3 样条

在电脑出现之前，人们想要画一条光滑的曲线时，他们会使用一片金属长条，然后将其弯曲成所需的形状，最后描出曲线。因为金属有延展性，它会弯出一个光滑的曲线。这样的金属片，我们称为 _样条_ 。

后来，数学家们发现，他们可以用分段多项式函数来表示出那个样子的曲线。以前，样条这个词表示的仅仅是光滑的分段多项式函数；现在，只要是分段多项式函数，均可以被称为样条。

对我们来说， _样条_ 是一个分段多项式函数。这样的函数在表示曲线时非常有用。

## 15.2 曲线的性质

为了描述一条曲线，我们需要给出一些定义，来描述它的性质。对于“有名字的”曲线，我们自然想到和曲线名字有关系的属性。例如，要描述一个圆，我们可以提供它的半径和圆心的位置。对于椭圆，我们还可以提供其长轴的方向和轴长之比。然而，对于自由曲线，我们需要一些更一般的属性来描述各段曲线的性质。

曲线的一些性质只与曲线上的某个位置有关，而另一些性质则是整个曲线都有的。为了直观地了解两者的区别，可以把曲线想象成火车轨道。如果你在雾天站在赛道上，你只能分辨出你所在的这段轨道是直的还是弯的，以及你是否在火车站（端点处）。这些是 _局部属性_ 。但是，你无法判断轨迹是否闭合，交叉，或者它有多长。我们称这种属性为 _全局属性_ 。

对几何物体（曲线和曲面）局部性质的研究被称为 **微分几何** 。曲线的性质要成为微分性质的话，这些性质有一些数学上的限制。这里我们使用 _局部性质_ 作为下面的描述，而不是数学上严格的微分性质。

局部性质是描述曲线的重要工具，因为它们不需要了解整个曲线。局部属性包括：

- 连续性
- 曲线上某一点的位置
- 曲线上某一点的方向
- 曲线上某一点的曲率（以及其他导数）

### 15.2.1 连续性

理解两条参数曲线的局部性质非常重要。如果曲线是用类似于 [式(15.2)] 的公式定义的，那么我们需要注意如何定义这些部分。如果 $\mathbf{f}_1(1)  \neq \mathbf{f}_2(0)$ ，那么曲线就“断了” —— 我们将无法连续一笔画出曲线。我们把曲线片段拼接在一起的条件称为 _连续性_ 条件，因为如果这个条件成立，曲线就是连续的线。

我们在本章开头对“曲线”的定义已经要求了曲线是连续的，所以上面那个线甚至不在曲线的范畴中。

除了位置，我们还可以检查曲线段的导数在端点处是否能匹配上。若 $\mathbf{f}'_1(1)  \neq \mathbf{f}'_2(0)$ ，那就说明曲线在端点的一阶导数会发生突变，也就是一阶导数不连续。一般来说，如果一条曲线的 $n$ 阶导数在每个端点上都能匹配，我们就说这条曲线是 $C^n$ 连续。我们将端点位置定义为零阶导数，因此 $C^0$ 连续就要求曲线的位置连续， $C^1$ 连续意味着位置和一阶导数都是连续的。曲线的定义要求曲线为 $C^0$ 连续。

[图 15-2] 展示了一些连续性条件。一阶导数的不连续（曲线是 $C^0$ ）通常看上去很明显，因为端点看上去是一个尖角。二阶导数的不连续有时能明显感知到。不同的应用，需要 0-=不同的连续性。例如，如果曲线表示运动，则二阶导数的突变也会很明显，因此表示运动需要三阶导数的连续性。如果曲线上有流体流过（例如，如果它是飞机机翼或船身的形状），那么四阶或五阶导数的不连续可能会导致湍流。

我们刚刚介绍的连续性类型（ $C^n$ ）通常被称为 **参数连续性** ，因为它存在于两个参数化曲线片段的交点处。如果我们画线的“速度”在端点处不同了，那么它们就不是连续的。而对于关心曲线形状而不是其参数化的情况，我们定义 **几何连续性** ，它要求当曲线被等效参数化时（例如，使用弧长参数化）曲线片段的导数能匹配。直观地说，这意味着相应的 **导数必须有相同的方向** ，即使它们的大小不同。

因此， $C^1$ 连续实际上是：

$$\mathbf{f}'_1(1)  = \mathbf{f}'_2(0)$$

$G^1$ 连续则是：

$$\mathbf{f}'_1(1)  =k \mathbf{f}'_2(0)$$

一般来说，几何连续性比参数连续性约束更少。只要参数的导数不消失， $C^n$ 曲线一定是 $G^n$ 。

## 15.3 多项式片段

计算机图形学中最广泛使用的曲线表示是将多项式定义的基本元素拼凑在一起，称为多项式片段。例如，线段元素是由线性多项式给出的。

在 [15.3.1 节] 中，我们给出了一个正式的定义，并解释了如何将多项式片段组合在一起。

### 15.3.1 多项式表示

多项式是这个样子的函数：

$$f(t) = a_0 + a_1t + a_2t_2 + ... + a_nt_n. \tag{15.3}$$

其中 $a_i$ 称为 _系数_ ，如果 $a_n\neq 0$ ，则 $n$ 称为多项式的次数。我们也可以把 [式(15.3)] 写成这样：

$$\mathbf{f} (t) = \sum_{i=0}^{n} \mathbf{a}_it^i \tag{15.4}$$

我们称它为多项式的 **标准型** 。

我们可以将标准型式推广为：

$$\mathbf{f} (t) = \sum_{i=0}^{n} \mathbf{c}_ib^i(t) \tag{15.5}$$

这里 $b_i(t)$ 是一个多项式。我们可以为不同的应用选择方便的多项式形式，这样的多项式函数我们称之为 **基函数** 或 _混合函数_ （见 [15.3.5 节] ）。在 [式(15.4)] 中， $t_i$ 对应 [式(15.5)] 的 $b_i(t)$ 。如果基函数集选择正确，则任何 $n+1$ 次的多项式曲线都可以用适当选择的控制点 $\mathbf{c}$ 表示出来。

我们不一定能给多项式曲线找到方便表示标准型的系数。出于实践的目的，在本章中，我们找到的一组基函数，这些基函数的系数都比较方便，能够控制由多项式函数曲线。

要指定一条二维空间中的曲线，可以指定 $t$ 中的两个多项式：一个表示 $x$ 如何随 $t$ 变化，另一个表示 $y$ 如何随 $t$ 变化；或者指定一个多项式，其中每个 $\mathbf{a}_i$ 都是一个二维的点。 $n$ 维空间中的曲线也一样。

### 15.3.2 线段

为了介绍分段多项式曲线表示的概念，我们将讨论线段。在实践中，线段非常简单，甚至不需要数学推导。然而，通过这个简单的例子，我们之后可以更容易理解复杂的多项式。

考虑一条连接点 $\mathbf{p}_0$ 和点 $\mathbf{p}_1$ 的线段。我们可以把这个线段在单位定义域域中的参数函数写成：

$$\mathbf{f}(u) = (1-u)\mathbf{p}_0 +u\mathbf{p}_1 \tag{15.6}$$

通过将其写成向量形式，我们隐藏了点的维度和我们分别处理每个维度的工作。例如，如果我们在二维中这样定义，我们实际上是定义了单独的两个方程：

$$f_x(u) = (1-u)x_0 +ux_1$$
$$f_y(u) = (1-u)y_0 +uy_1$$

我们定义的直线由两个端点确定，但从现在开始，我们会在之后的讲解中使用向量符号，因为它更简洁明了。我们将参数所控制的向量 $\mathbf{p}$ 称为控制点集， $\mathbf{p}$ 中的每个元素称为一个 **控制点** 。

虽然用其端点的位置来描述线段是简洁且方便的，但描述线段还有其他方法。例如：

1. 线段中心的位置、线段方向、线段长度
2. 线段一个端点的位置和第二个端点相对于第一个端点的偏移量
3. 线段的中点和其中一个端点的位置

只要知道上面的其中一条，我们就能确定一个线段。

描述线段的另一种方法是使用多项式的标准型式（如 [15.3.1 节] 所述）：

$$\mathbf{f}(u) = \mathbf{a}_0+u\mathbf{a}_1 \tag{15.7}$$

任何线段都可以通过指定 $\mathbf{a}_0$ 和 $\mathbf{a}_1$ 或端点（ $\mathbf{p}_0$ 和 $\mathbf{p}_1$ ）来表示。指定端点通常更方便，因为那样我们可以从端点计算其他参数。

为了将标准型式写成向量表达式，我们定义一个向量 $\mathbf{u}$ ，它是 $u$ 的幂向量：

$$\mathbf{u} = [1 \ u \ u^2 \ u^3 \dots \ u^n]$$

这样 [式 15.4] 就可以写成

$$\mathbf{f}(u) = \mathbf{u} \cdot \mathbf{a} \tag{15.8}$$

这种向量符号能让不同形式的曲线之间更加容易转换。

[式(15.8)] 用多项式化简后的多项式系数集来描述曲线段。我们称这种表示为 **标准型** 。我们用 $\mathbf{a}$ 表示标准型的参数。

虽然它在数学上很简单，但标准型并不总是表示曲线的最方便的方式。例如，我们可能更喜欢通过其 **端点的位置** 来指定线段。如果我们想定义 $\mathbf{p}_0$ 为线段的起点（即线段在 $u = 0$ 时的位置）， $\mathbf{p}_1$ 为线段的终点（即线段在 $u = 0$ 时的位置），我们可以这样写：

$$\mathbf{p}_0 = \mathbf{f}(0) = [1 \ 0 ] \cdot [\mathbf{a}_0 \ \mathbf{a}_1]$$

$$\mathbf{p}_0 = \mathbf{f}(1) = [1 \ 1 ] \cdot [\mathbf{a}_0 \ \mathbf{a}_1] \tag{15.9}$$

我们可以解出 $\mathbf{a}_0$ 和 $\mathbf{a}_1$ 的方程：

$$
\begin{align*}
  \mathbf{a}_0 &= \mathbf{p}_0 \\
\mathbf{a}_0 &= \mathbf{p}_1-\mathbf{p}_0
\end{align*}
$$

#### 多项式的矩阵形式

上面所说的第一个例子很容易解决，但对于更复杂的例子，将方程 (15-9) 写成以下形式更容易理解：

$$
\left [ \begin{matrix} \mathbf{p}_0 \\ \mathbf{p}_1 \\ \end{matrix} \right ] =
\left [ \begin{matrix} 1 & 0\\ 1 & 1 \\ \end{matrix} \right ]
\left [ \begin{matrix} \mathbf{a}_0 \\ \mathbf{a}_1 \\ \end{matrix} \right ]
$$

这样我们就能将上式写成

$$\mathbf{p}  = \mathbf{C} \ \mathbf{a} \tag{15.10}$$

我们称 $\mathbf{C}$ 为 **约束矩阵** 。 如果你觉得点向量比较难理解，你可以独立地考虑每个维度的分量（这样， $\mathbf{p}$ 就是 $[x_0 \ x_1]$ 或 $[y_0 \ y_1]$ ； $\mathbf{a}$ 也同样分解）。

我们可以通过求 $\mathbf{C}$ 的逆矩阵来解出方程 (15-10) 中的 $\mathbf{a}$ 。我们将逆矩阵用 $\mathbf{B}$ 表示，称为 **基矩阵** 。基矩阵具有很好的性质，因为它告诉我们如何在参数型 $\mathbf{p}$ 和标准型 $\mathbf{a}$ 之间进行转换。因此，我们得到了一个计算曲线的简单方法：

$$\mathbf{f}(u)  = \mathbf{u} \ \mathbf{B} \ \mathbf{p} = \mathbf{u} \ \mathbf{a}$$

我们可以为曲线的任何形式找到一个基矩阵，只要参数的定义中没有 _非线性参数_ 。例如，我们使用线段的长度和角度来定义曲线，那么它的参数就是非线性的。

现在，假设我们要对线段进行参数化，使 $\mathbf{p}_0$ 为中点 $(u = 0.5)$ ， $\mathbf{p}_1$ 为终点 $(u = 1)$ 。为了导出该参数化的基矩阵，我们设置以下的转换：

$$
\begin{align*}
  \mathbf{p}_0 = \mathbf{f}(0.5) &= 1\mathbf{a}_0 + 0.5\mathbf{a}_1 \\
\mathbf{p}_0 = \mathbf{f}(1) &= 1\mathbf{a}_0 + 1\mathbf{a}_1
\end{align*}
$$

这样

$$\mathbf{C} = \left [ \begin{matrix} 1 & 0.5 \\ 1 & 1 \\ \end{matrix} \right ],$$

$$\mathbf{B} = \mathbf{C}^{-1} = \left [ \begin{matrix} 2 & -1 \\ -2 & 2 \\ \end{matrix} \right ],$$

### 15.3.3 线段之外更复杂的表示

线段太简单了，我们很容易就能找到一个基矩阵。让我们来尝试一下给阶数更高的曲线找一个基矩阵。首先，让我们看看二次曲线（也就是阶数为二次的曲线）。这时我们能发现标准型（ 式(15.4) ）的优点，就是标准型适用于更复杂的曲线，我们只需要改变标准型中的阶数 $n$ 即可。

二次多项式有三个系数： $a_0$ 、 $a_1$ 和 $a_2$ 。

这些系数不太好描述曲线的形状。不过，我们可以使用相同的基矩阵方法来设计更方便的参数。如果我们知道 $u$ 的值，则 式(15.4) 就会在参数中变为一个线性方程，我们还是可以使用上一节的线性代数来进行变换。

假设我们想用起始点 $(u = 0)$ 、中间点 $(u = 0.5)$ 和终点 $(u = 1)$ 的位置来描述我们的曲线。在 式(15.4) 中输入合适的值：

$$
\begin{align*}
  \mathbf{p}_0 &=& \mathbf{f}(0) &=& &\mathbf{a}_0& + &0^1& &\mathbf{a}_1 + &0^2&
  &\mathbf{a}_2 \\
  \mathbf{p}_1 &=& \mathbf{f}(0.5) &=& &\mathbf{a}_0& + &0.5^1& &\mathbf{a}_1 + &0.5^2& &\mathbf{a}_2 \\
  \mathbf{p}_2 &=& \mathbf{f}(1) &=& &\mathbf{a}_0& + &1^1& &\mathbf{a}_1 + &1^2& &\mathbf{a}_2 \\
\end{align*}
$$

约束矩阵是

$$\mathbf{C} = \left [ \begin{matrix} 1 & 0 & 0 \\ 1 & 0.5 & 0.25 \\ 1 & 1 & 1 \\\end{matrix} \right ],$$

基矩阵是：

$$\mathbf{B} = \mathbf{C}^{-1} = \left [ \begin{matrix} 1 & 0 & 0 \\ -3 & 4 & -1 \\ 2 & -4 & 2 \\\end{matrix} \right ],$$

指定某些其他约束（或参数）有时会让计算变得更方便：例如曲线在特定值处的导数（与自由参数相比）。直观上，导数告诉我们曲线如何变化，一阶导数告诉我们曲线的方向，二阶导数告诉我们曲线改变方向的速度等。稍后我们将看到一些例子，说明为什么指定导数作为参数会更好。

对于一个二次曲线：

$$\mathbf{f}(u) = \mathbf{a}_0 + \mathbf{a}_1u+\mathbf{a}_2u^2,$$

它的一阶和二阶导数很简单：

$$\mathbf{f}'(u) = \frac{d\mathbf{f}}{du} = \mathbf{a}_1+2\mathbf{a}_2u,$$
$$\mathbf{f}''(u) = \frac{d^2\mathbf{f}}{du^2} = \frac{d\mathbf{f}}{du}' =  2\mathbf{a}_2,$$

更一般地，

$$
\begin{align*}
  \mathbf{f}'(u) &= \sum_{i=1}^{n}iu^{i-1}\mathbf{a}_i \\
   \mathbf{f}''(u) &= \sum_{i=2}^{n}i(i-1)u^{i-2}\mathbf{a}_i
\end{align*}
$$

例如，考虑这样一种情况，我们希望通过其中间的位置、一阶导数和二阶导数来指定一条二次曲线段 $(u = 0.5)$ 。

$$
\begin{align*}
  \mathbf{p}_0 &=& \mathbf{f}(0.5) &=& \mathbf{a}_0 + 0.5^1 \ \mathbf{a}_1 + 0.5^2
  &\mathbf{a}_2& \\
  \mathbf{p}_1 &=& \mathbf{f}(0.5) &=&   \mathbf{a}_1 + 2 \ 0.5 \ &\mathbf{a}_2& \\
  \mathbf{p}_2 &=& \mathbf{f}(0.5) &=&  + 2 \  &\mathbf{a}_2& \\
\end{align*}
$$

约束矩阵是：

$$\mathbf{C} = \left [ \begin{matrix} 1 & 0.5 & 0.25 \\ 0 & 1 & 1 \\ 0 & 0 & 2 \\\end{matrix} \right ],$$

基矩阵是：

$$\mathbf{B} = \mathbf{C}^{-1} = \left [ \begin{matrix} 1 & -0.5 & 0.125 \\ 0 & 1 & -0.5 \\ 0 & 0 & 0.5 \\\end{matrix} \right ],$$

### 15.3.4 三次曲线的基矩阵

三次多项式在图形学中很常见 （见 [15.5 节] ）。各种形式的三次曲线的推导就像我们在这一节已经看到的推导。我们将再通过一个例子进行练习。

三次多项式的一种非常有用的形式是 _埃尔米特形式_ 。

> 三次埃尔米特是指使用初始点，初始速度（向量），最终点，最终速度（向量）四个参数来确定的三次多项式函数曲线。

这个曲线的四个控制点是 开始和结束时是位置和一阶导数，即，

$$
\begin{align*}
  \mathbf{p}_0 &=& \mathbf{f}(0) &=& \mathbf{a}_0 + 0^1 \ \mathbf{a}_1 &+& 0^2 \mathbf{a}_2 &+& 0^3 &\mathbf{a}_3&\\
  \mathbf{p}_1 &=& \mathbf{f}'(0) &=&  \mathbf{a}_1 &+& 2 \ 0^1 \ \mathbf{a}_2 &+& 3 \ 0^2 \ &\mathbf{a}_3&\\
  \mathbf{p}_2 &=& \mathbf{f}(1) &=& \mathbf{a}_0 + 1^1 \ \mathbf{a}_1 &+& 1^2 \ \mathbf{a}_2 &+ &1^3 &\mathbf{a}_3&\\
  \mathbf{p}_3 &=& \mathbf{f}'(1) &=& \mathbf{a}_1 &+& 2 \ 1^1  \mathbf{a}_2 &+& 3 \ 1^2 \ &\mathbf{a}_3&\\
\end{align*}
$$

约束矩阵是：

$$
\mathbf{C} = \left [ \begin{matrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
1 & 1 & 1 & 1 \\
0 & 1 & 2 & 3 \\ \end{matrix} \right ],
$$

基矩阵是：

$$
\mathbf{B} = \mathbf{C}^{-1} = \left [ \begin{matrix}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
-3 & -2 & 3 & -1 \\
2 & 1 & -2 & 1 \\ \end{matrix} \right ],
$$

我们将在 [15.5.2 节] 讨论 _三次埃尔米特样条_ 。

### 15.3.5 混合函数

如果我们知道基矩阵 $\mathbf{B}$ ，我们可以把它乘以参数向量 $\mathbf{u}$ ，得到一个函数向量：

$$\mathbf{b}(u) = \mathbf{u} \ \mathbf{B}$$

注意，我们用 $\mathbf{b}(u)$ 表示这个向量是为了强调它的值是由 自由参数 $u$ 决定的。我们称 $\mathbf{b}(u)$ 的元素为 **混合函数** ，因为这些函数指定了如何将控制点的值混合在一起：

$$\mathbf{f}(u) = \sum_{i=0}^{n} \mathbf{b}_i(u)\mathbf{p}_i \tag{15.11}$$

要注意，对于选定的 $u$ 值，式(15.11) 始终是一个 _线性方程_ ，它让控制点能够 _线性混合_ （即加权平均）。无论多项式在 $\mathbf{b}_i$ 函数内部是啥样，它都是一个线性函数。

混合函数为描述曲线提供了一个很好的抽象。任何类型的曲线都可以表示为其控制点的线性组合，这些权重就是自由参数组成的函数。

### 15.3.6 多项式插值

一般来说，针对 $n$ 个点进行多项式曲线插值，需要多项式的阶数是 $n+1$ 阶。如果我们现在有一个向量 $\mathbf{p} = (p_0,\dots,p_n)$ ，要对一个系数向量 $\mathbf{t} = (t_0,\dots,t_n)$ 进行插值，我们可以用前面讲过的基矩阵法，找到一个 $(n+1)\times(n+1)$ 的基矩阵，这样能得到函数 $f(t)$ ，使 $f(t_i) = p_i$ 。

对于任意给定的向量 $\mathbf{t}$ ，我们需要建立并求解一个 $n = 1 \times n+1$ 的线性方程组。这为我们提供了一组共 $n+1$ 个基函数来执行插值：

$$\mathbf{f}(t) = \sum_{i=0}^{n} \mathbf{p}_ib_i(t).$$

这些插值基函数可以用其他方法推导出来。定义它们的一种特别优雅的方式是拉格朗日形式：

$$b_i = \prod_{j=0,j \neq i}^{n} \frac{x-t_j}{t_i-t_j} \tag{15.12}$$

有比拉格朗日形式（参见 De Boor(1978)）更有效的计算方式来表达插值基函数。

**总结：** 插值多项式让我们能够定义一组点的插值曲线。 [图 15-3] 显示了一些示例。虽然理论上可以创建一个多项式来插值任意数量的点，但我们很少使用高阶多项式来表示计算机图形学中的曲线，这样求解会比较困难。相反，我们更喜欢使用样条（分段多项式函数）进行插值。 [15.5.3 节] 将讨论其中的一些原因。
