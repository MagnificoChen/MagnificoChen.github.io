# 每个软件开发人员都必须要了解的 Unicode 和 字符集 知识

## By ***Joel Spolsky***

你有没有看到过网页审查元素后，放在顶上的标签，里面写着 ```Content-Type``` ？或者，你看了它大半辈子都不知道它是甚么？

或者，你有没有收到过外国人的电子邮件，标题是一堆问号乱码？

我很沮丧地发现，好多软件开发人员并没有完全跟上字符集、编码、Unicode 等的脚步。几年前， [FogBUGZ](http://www.fogcreek.com/FogBUGZ) 的 beta测试人员想知道我们的程序是否可以处理日语传入的电子邮件。嗯？我们会收到日语电子邮件吗？但当我仔细看了看我们用来解析 MIME 电子邮件的商业 ActiveX 控件时，我们发现程序在处理字符集的时候犯了错误，所以我只能重写了一些代码，从而不让原程序瞎寄吧转编码。不仅如此，我查看另一个商用代码库时，它也有一个完全没法用的字符代码转换功能。我去找了该软件的开发人员，但软件开发人员也不会，觉得“寄了”。

最后，当我发现连网站开发工具 **PHP** 都完全不care字符编码问题，以至于我不能用它开发国际化的网页应用时，我实在是忍不了了。

所以我要宣布个事儿：现在已经3202年了，如果你还想当一个 2003 年的程序员，不知道字符、字符集、编码和 Unicode 的基础知识，被我逮到了可没你好果汁吃。 ~~哦！我的老天爷，我会拿我的鞋拔子狠狠的抽你的屁股，我发誓。~~

忘记说了，学会这些东西，<span style="font-size:150%"> **并不难** 。</span>

在本文中，我将介绍每个开发程序员应该知道的内容。“纯文本 = ASCII = 8位字符”的东西不仅是错的，而且错得离谱。如果现在还这样想，并用这样的思路编程，那你就像个头疼要砍头的医生。再加一句：请看完本文之后再写代码。

开始之前，我想说的是，如果你是那些了解国际化开发的少部分人，你会发现我的讨论很小儿科。但我想要的是所有看我文章的人都能弄懂我到底在讲什么，并且有能力带着这份知识编写代码。字符处理只是创建国际通用软件所需工作的一小部分，但我一次只能讲一节课，所以今天我讲字符集。

### 时间线

你可能认为我会在这里谈论像 **EBCDIC** 这样的非常古老的字符集。我不。**EBCDIC** 太古老了，和我们现在无关。我们不必回到那么久以前。

回到半古老的时代，当 Unix 刚被发明， K&R 正在编写 C语言 时，编码还是非常简单的。 **EBCDIC** 已经要退出历史舞台了。我们当时只关心英语字母。幸运的是，我们有一个叫做 **ASCII** 的代码，它能够使用 32 到 127 之间的数字来表示每个字符。空格符是  32 ，字母 “A” 是 65 ，等等。我们只需要花 7 位就可以存储它了。当时大多数计算机都使用 8 位字节，所以你不仅可以存储每个 ASCII 字符，你还有一大堆冗余的空间用来干坏事。低于 32 的编码字符叫 **控制字符** ，例如 7 可以让你的电脑发出蜂鸣声，12 可以让当前纸张页从打印机中飞出并输入新的纸张。

岁月静好，只因你是一个说英语的人。

因为一个字节有多达八位的空间，所以很多人开始想，“哇！我们可以将代码 128-255 留着自用。问题就来了：很多人同时都有这个想法，且 128-255 它们都有自己的用途。IBM-PC 有一些后来被称为 *OEM字符集* 的东西，它为欧洲语言提供了一些重音字符和一堆绘制表格的符号：横杠、竖条，T形杠等，可以使用这些线条画字符在屏幕上制作漂亮的表格和线条。有些 8086 处理器的古董机还能看得到这样的字符集。但是，人们从美国以外购买电脑时，就出现了好多好多不同的 OEM字符集 。这些字符集都用编码存在的那额外的128个位置来实现自己的功能。例如，在某些PC上，字符代码130将显示为 $é$  ，但在以色列销售的计算机上，它是希伯来字母Gimel（ $ג$ ），因此如果一个美国人将简历发送到一个以色列人那， $\rm résumé$ 会变成 $\rm rגsumג$。在许多情况下，如俄语，对于如何处理那 128 个字符有很多不同的方法，因此，在俄罗斯人和俄罗斯人之间，甚至都无法可靠地交换俄语文档。

最终，这种 OEM的产物 被编入了 **ANSI标准** 。在 ANSI 标准中，编码 128 以下是统一的，这和 ASCII 编码一致，但是 ANSI 规定了很多不同的方法来处理 128 及以上的字符，由您居住的地方而决定。这些不同的系统称为 [**代码页 Code Pages**](https://learn.microsoft.com/zh-CN/windows/win32/intl/code-pages) 。例如，在以色列， DOS 使用名为 862 的代码页，而希腊用户使用 737 。它们的编码在128以下是一样的，但在128以上就不同了，不同国家的字母都存放在那里。 MS-DOS 的国家版本有几十个这样的代码页，处理从英语到冰岛语的所有内容，他们甚至有一些“多语言”代码页，可以在同一台计算机上进行世界语和加利西亚语！真不错！但是，除非你编写了一个自定义程序，使用位图图形显示不同的语言，否则在同一台计算机上同时显示希伯来语和希腊语是完全不可能的，因为希伯来语和希腊语需要不同的代码页，高位的编码都不一样。

与此同时，在亚洲，更疯狂的事情正在发生，考虑到亚洲语言需要显示成千上万个不同的字，8 位编码不管咋样都是不够的。那时候我们一般用 **DBCS（双字节字符集）** 解决这个问题，其中，一些字母只需一个字节存储，而很多字则需要两个字节。因为这个编码很混乱，程序员在使用 ```String``` 的时候就不能用  ```s++``` 和 ```s--``` 前后移动字符串指针了，而是得调用 Windows 的```AnsiNext``` 和 ```AnsiPrev``` 才能处理。

但与此同时，别人都不知道你使用了这样的编码。那时候网络不发达，大家也很少把电脑文件传来传去。大家都还是认为一个字节是一个字符，一个字符是 8 位。但是，互联网出现了，一切都乱套了。在这个时候，```Unicode``` 闪亮登场。

### Unicode

Unicode勇敢地创造了一个字符集，其中包括地球上所有合理的书写系统，以及一些虚构的书写系统，如克林贡语(Klingon)。有些人误解了，认为 Unicode 只是一个16位的编码，每个字符需要 16 位，就会有 65 536 个可能的字符。这实际上是不正确的。

